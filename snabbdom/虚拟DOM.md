## 什么是虚拟 DOM
- 虚拟 DOM 就是指的一个js对象，该对象描述了一个 DOM 的基本信息。
  
## 为什么要使用虚拟 DOM
- 创建一个真实 DOM 时，它的属性非常多开销很大，而虚拟 DOM 只需要必需的一些描述信息，开销很小。
- 在 JQ 时代，我们更新视图时，需要先更新数据，然后再更新视图，开发非常繁琐。
- 模板引擎的出现让我们不再关注视图，只需负责关注数据，但是模板引擎无法跟踪状态，只有第一次渲染有效，之后的试图更新需要删除所有 DOM 节点重新创建，性能很差。
- 虚拟 DOM 可以维护程序状态，跟踪状态变化，通过前后两次的状态变化差异只更新发生变化的 DOM，提高性能。
- 跨平台！

## 虚拟 DOM 库
- Snabbdom vue2.x内部使用的虚拟 DOM 就是改造的 Snabbdom
- Virtual-dom

## h
- 处理传入的函数 生成虚拟dom 就是一个普通的 js 对象，该对象存储了sel标签信息，data属性、样式、事件钩子等信息，children子节点信息

## patch 调用 patchVnode 对新老节点进行 domdiff
1. 新节点是文本节点 且 与旧节点文本不一致，将旧节点文本改为新文本，删除旧节点的子节点
2. 新节点不是文本节点
   1. 新节点有儿子节点 老节点没用 在老节点上添加所有的子节点
   2. 老节点有儿子节点 新节点没用 删除所有子节点
   3. 老节点是文本节点 将文本替换为空
   4. 新老节点都有子节点 调用 updateChildren 更新儿子节点
      1. 使用双指针法
      2. 判断新老节点的头部节点是否一致
         1. 一致调用 patchVnode 递归判断子节点，新老节点后移
      3. 判断新老节点尾部节点是否一致
         1. 一致调用 patchVnode 递归判断子节点，新老节点前移
      4. 判断新节点头部 跟 老节点尾部是否一致
         1. 一致调用 patchVnode 递归判断子节点，新节点后移 老节点前移
         2. 说明老节点尾部元素移动到了新节点前边，调用 insertBefore 插入到老的开始节点之前
      5. 判断新节点尾部 跟 老节点头部是否一致
         1. 一致调用 patchVnode 递归判断子节点，新节点前移 老节点后移
         2. 说明老节点头部元素移动到了新节点后边，调用 insertBefore 插入到老的结束节点之前
      6. 都不符合前四种优化方案
      7. 根据老节点的 key 生成 映射表
      8. 遍历新节点，通过新节点的 key 获取到可复用老节点
      9. 没用可复用老节点说明是新节点 生成新节点插入到老的开始节点之前
      10. 有可复用的老节点，需要将其移动到老的开始节点之前
      11. 遍历结束后，如果老节点没用遍历完，需要将这些没用的节点删除
      12. 如果新节点没用遍历完，说明是新增节点，将其插入到老的结束节点之前